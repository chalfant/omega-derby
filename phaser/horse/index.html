<!doctype html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>hello horse!</title>
  <script src="phaser.min.js"></script>
</head>
<body>

  <script type="text/javascript">

  window.onload = function() {

    var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update });
    var horses = [];
    var running = false;

    function preload () {

      game.load.image('dirt', 'assets/dirt.png');
      game.load.image('stands', 'assets/grandstands.png');

      game.load.image('horse1', 'assets/horse.gif');
      game.load.image('horse2', 'assets/horse2.gif');
      game.load.image('horse3', 'assets/horse3.gif');
      game.load.image('horse4', 'assets/horse4.gif');
      game.load.image('horse5', 'assets/horse5.gif');

      game.load.audio('sfx', 'assets/post.mp3');
    }

    function startRace() {
      running = true;
    }

    function create () {

      var stands = game.add.sprite(0,0, 'stands');

      this.background = this.add.tileSprite(0,stands.height, this.world.width, 5*64-32, 'dirt');

      var sfx = game.add.audio('sfx');
      sfx.addMarker('start', 0, 6);
      sfx.onStop.add(startRace);
      sfx.play('start');

      var margin = stands.height - 32;
      var pad = 0;
      var horseHeight = 64;
      for (var i=0; i<5; i++) {
        var y_pos = margin + i * (pad + horseHeight);
        horses[i] = game.add.sprite(0, y_pos, 'horse'+(i+1));
        // var tween = game.add.tween(horses[i]);
        // tween.to({ x: 100 + 50*Math.random() }, 1000)
        //   .to({ x: 200 + 50*Math.random()}, 1000)
        //   .to({ x: 300 + 50*Math.random()}, 1000)
        //   .to({ x: 400 + 50*Math.random()}, 1000)
        //   .to({ x: 600 + 50*Math.random()}, 1000);

        // tween.start();
      };
    }

    function update () {
      if (!running) {
        return;
      }

      for (var i = horses.length - 1; i >= 0; i--) {
        horses[i].x += game.rnd.frac()*10;

        if (horses[i].x >= 600) {
          running = false;
        }
      };
    }
  };

  </script>

</body>
</html>